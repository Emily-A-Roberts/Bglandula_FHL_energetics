{
  "hash": "d1fd3ae67a16c6f85f713dc94e457b8c",
  "result": {
    "markdown": "---\ntitle: \"model setup\"\nformat: html\neditor: visual\n---\n\n\n## Aim: Read in environmental data and physiology functions\n\n# File information\n\n\\~/Library/CloudStorage/Box-Box/Sarah and Molly's Box/FHL data/code/set_up_workspace/Model_20210409_iter_small_barnacles_food.2.R\n\nThis is now set up to work with the desktop computer (different working directory) -1/20/21\n\nThis sets up all of the data and functions for the model predictions\n\nThis model is calibrated with Lisa's data, and includes padilla bay chlorophyll seasonal data. To go back to Lisa's dataset and check the calibration, please use this model setup.\n\nThis model uses lengths rather than tissue mass samples. Go back to previous models, e.g. Model_202006..\\_iter... for tissue mass\n\n# Datasets used are within the following directories:\n\nIf the file is opened within the .Rproj file, then the function here::here() will find the correct data file regardless of where this is being run. An alternative option is to set the root drive using knitr, but I'm having trouble doing this with quarto. Quarto seems to require that all the .qmd files live within the root directory.\n\n\n\n\n\n# Set up environment\n\nClear the global environment\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list = ls())\n```\n:::\n\n\nLoad libraries and set graphics theme:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: stats4\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: Matrix\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: carData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nlattice theme set by effectsTheme()\nSee ?effectsTheme for details.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'nlme'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:lme4':\n\n    lmList\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: viridisLite\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: timechange\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'lubridate'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:nlme':\n\n    collapse\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:bbmle':\n\n    slice\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'tidyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:Matrix':\n\n    expand, pack, unpack\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'gridExtra'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'kableExtra'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n:::\n:::\n\n\nToggle the period of interest (which 6 month period - the first or second?)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Time period 1 or 2\ntiming <- 1\n```\n:::\n\n\nToggle the subset of barnacles used (specify only small baracles will be used for calculations)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Which subset of barnacles\nsmall_only<-\"Y\"\n```\n:::\n\n\nToggle plots on and off (turning plotting off will speed up the code)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Turn plotting on and off (for the sake of speeding up the iterations)\nfigs <- \"Y\" #(Y or N)\n```\n:::\n\n\nMore toggles\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Food dynamics hypothesis\nPadillaBay = \"Y\"\n\n#Test run?\nbaby_model <- \"Y\" #Test run\nbaby_model <- \"N\" #All data\n```\n:::\n\n\nSet up dataframes to be used in plotting functional responses\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| echo: false\n\n# Plotting values for functional responses\n\npred.dat <- data.frame(\n  Temp.n = rep(seq(from = 5, to = 40, length.out = 20), times = 3),\n  OperculumLength = rep(c(4.5, 5.5, 6.5),times = 3,each = 20),\n  sizeclass = as.factor(rep(c(\"small\",\"medium\", \"large\"),times = 3,each = 20))\n)\n\npred.dat.aqua <- data.frame(\n  Temp.n = rep(seq(from = 5, to = 20, length.out = 20), times = 3),\n  OperculumLength = rep(c(4.5, 5.5, 6.5),times = 3,each = 20),\n  sizeclass = as.factor(rep(c(\"small\",\"medium\", \"large\"),times = 3,each = 20))\n)\n\npred.dat.air <- data.frame(\n  Temp.n = rep(seq(from = 5, to = 40, length.out = 20), times = 3),\n  OperculumLength = rep(c(4.5, 5.5, 6.5),times = 3,each = 20),\n  sizeclass = as.factor(rep(c(\"small\",\"medium\", \"large\"),times = 3,each = 20))\n)\n```\n:::\n\n\nSet up climate change calculator\n\n\n::: {.cell}\n\n:::\n\n\n# Read in opercular length growth data\n\nPrevious directories included: setwd(\"C:/Users/eroberts/Box/PhotoAnalysis_Sp2020/datasheets_org/20201007_data\") setwd(\"\\~/Box/PhotoAnalysis_Sp2020/datasheets_org/20201007_data\") setwd(\"\\~/Box/PhotoAnalysis_Sp2020/FHL/datasheets_org/20201007_data\")\n\nand setwd(\"\\~/Box/Sarah and Molly's Box/FHL data/growth_individual/ForSam_20201007\")\n\nand setwd(\"\\~/Library/CloudStorage/Box-Box/PhotoAnalysis_Sp2020/FHL/datasheets_org/20201007_data/probably final data set\")\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Note the here() function finds the file from the root directory. The root directory is set from running through the project in github. \ngrowth.1 <- read.csv(here::here(\"data/growth_data/Scaled_data_Feb_Aug.csv\"))\ngrowth.2 <- read.csv(here::here(\"data/growth_data/Scaled_data_Aug_Mar.csv\"))\n\n# Quality control\ngrowth.2 <- growth.2[growth.2$Elevation!=\"\",] #one line of NA's\ngrowth.1 <- growth.1[growth.1$growth.Aug.Feb>=-.1,] #one line of an outlier with a growth of >-0.1\n\n# Structure dataframe\ngrowth.1$Elevation <- as.factor(growth.1$Elevation)\ngrowth.2$Elevation <- as.factor(growth.2$Elevation)\n\n# Subset by size\nsmall_only <- \"Y\"\nif(small_only==\"Y\"){\n  small.1 <- growth.1[growth.1$Feb.Length >= 0.15 & growth.1$Feb.Length <= 0.30,]\n  small.2 <- growth.2[growth.2$Aug.Length >= 0.15 & growth.2$Aug.Length <= 0.30,]\n  \n  growth.1 <- small.1\n  growth.2 <- small.2\n}\n\n# Subset the data for test run if flagged\nif(baby_model==\"Y\"){\n  growth.1.ave <- growth.1 %>%\n    group_by(Elevation)%>%\n    dplyr::summarise(\n      n = n(),\n      growth.Aug.Feb = mean(growth.Aug.Feb, na.rm = TRUE),\n      Feb.Length = mean(Feb.Length, na.rm = TRUE),\n      Aug.Length = mean(Aug.Length, na.rm = TRUE)\n    ) \n  growth.2.ave <- growth.2 %>%\n    group_by(Elevation)%>%\n    summarise(\n      n = n(),\n      growth.Mar.Aug = mean(growth.Mar.Aug, na.rm = TRUE),\n      Aug.Length = mean(Aug.Length, na.rm = TRUE),\n      Mar.Length = mean(Mar.Length, na.rm = TRUE)\n    ) \n  growth.1 <- as.data.frame(growth.1.ave)\n  growth.2 <- as.data.frame(growth.2.ave)\n}\n\nif(figs == \"Y\"){\n  par(mfrow = c(1,2))\n  plot(growth.1$Feb.Length, growth.1$growth.Aug.Feb, \n       col = as.factor(growth.1$Elevation),  \n       ylim = c(-.1,.5), xlim = c(.15,.3),\n       ylab = \"Growth Feb to Aug (cm)\",\n       xlab = \"Initial length (cm)\"\n  )\n  plot(growth.2$Aug.Length, growth.2$growth.Mar.Aug, \n       col = as.factor(growth.2$Elevation), \n       ylim = c(-.1,.25), xlim = c(.15,.3), \n       ylab = \"Growth Aug to Mar (cm)\",\n       xlab = \"Initial length (cm)\"\n  )\n\npar(mfrow = c(1,3))\nhist(growth.2$growth.Mar.Aug[growth.2$Elevation==\"Upper\"], \n     main = \"Upper Mar - Aug\", xlab = \"Change in operculum length (cm)\")\nhist(growth.2$growth.Mar.Aug[growth.2$Elevation==\"Mid\"], \n     main = \"Mid Mar - Aug\", xlab = \"Change in operculum length (cm)\")\nhist(growth.2$growth.Mar.Aug[growth.2$Elevation==\"Low\"], \n     main = \"Low Mar - Aug\", xlab = \"Change in operculum length (cm)\")\n}\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::\n\n\nMore growth plots and table\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1,2))\n\nplot(as.factor(growth.2$Elevation), growth.2$growth.Mar.Aug, ylim = c(-.08, 0.25), ylab = \"Growth (mm)\", xlab = \"Elevation\")\nplot(as.factor(growth.1$Elevation), growth.1$growth.Aug.Feb, ylim = c(-.08, 0.25), ylab = \"\", xlab = \"Elevation\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# No interactions:\npar(mfrow = c(1,2))\n# summary(lm(growth.1$growth.Aug.Feb~as.factor(growth.1$Elevation)+as.numeric(growth.1$Feb.Length)))\n\n# Time 1\nmod1 <- lm(growth.Aug.Feb~Elevation*Feb.Length, data = growth.1)\nkbl(coef(summary(mod1)))%>%\n  kable_classic_2(full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic-2\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> t value </th>\n   <th style=\"text-align:right;\"> Pr(&gt;|t|) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 0.1506457 </td>\n   <td style=\"text-align:right;\"> 0.0910366 </td>\n   <td style=\"text-align:right;\"> 1.6547820 </td>\n   <td style=\"text-align:right;\"> 0.1001023 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationMid </td>\n   <td style=\"text-align:right;\"> -0.1066055 </td>\n   <td style=\"text-align:right;\"> 0.0999380 </td>\n   <td style=\"text-align:right;\"> -1.0667167 </td>\n   <td style=\"text-align:right;\"> 0.2878486 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationUpper </td>\n   <td style=\"text-align:right;\"> -0.0981680 </td>\n   <td style=\"text-align:right;\"> 0.0941666 </td>\n   <td style=\"text-align:right;\"> -1.0424921 </td>\n   <td style=\"text-align:right;\"> 0.2988950 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Feb.Length </td>\n   <td style=\"text-align:right;\"> -0.2727793 </td>\n   <td style=\"text-align:right;\"> 0.3539495 </td>\n   <td style=\"text-align:right;\"> -0.7706730 </td>\n   <td style=\"text-align:right;\"> 0.4421377 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationMid:Feb.Length </td>\n   <td style=\"text-align:right;\"> 0.2927743 </td>\n   <td style=\"text-align:right;\"> 0.3934002 </td>\n   <td style=\"text-align:right;\"> 0.7442148 </td>\n   <td style=\"text-align:right;\"> 0.4579346 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationUpper:Feb.Length </td>\n   <td style=\"text-align:right;\"> 0.2992674 </td>\n   <td style=\"text-align:right;\"> 0.3718298 </td>\n   <td style=\"text-align:right;\"> 0.8048505 </td>\n   <td style=\"text-align:right;\"> 0.4222058 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n  # No interactions\nmod1 <- lm(growth.Aug.Feb~Elevation+Feb.Length, data = growth.1)\nkbl(coef(summary(mod1)))%>%\n  kable_classic_2(full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic-2\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> t value </th>\n   <th style=\"text-align:right;\"> Pr(&gt;|t|) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 0.0802769 </td>\n   <td style=\"text-align:right;\"> 0.0275039 </td>\n   <td style=\"text-align:right;\"> 2.9187498 </td>\n   <td style=\"text-align:right;\"> 0.0040599 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationMid </td>\n   <td style=\"text-align:right;\"> -0.0325974 </td>\n   <td style=\"text-align:right;\"> 0.0168518 </td>\n   <td style=\"text-align:right;\"> -1.9343539 </td>\n   <td style=\"text-align:right;\"> 0.0549646 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationUpper </td>\n   <td style=\"text-align:right;\"> -0.0232475 </td>\n   <td style=\"text-align:right;\"> 0.0160775 </td>\n   <td style=\"text-align:right;\"> -1.4459641 </td>\n   <td style=\"text-align:right;\"> 0.1502874 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Feb.Length </td>\n   <td style=\"text-align:right;\"> 0.0045558 </td>\n   <td style=\"text-align:right;\"> 0.0912726 </td>\n   <td style=\"text-align:right;\"> 0.0499146 </td>\n   <td style=\"text-align:right;\"> 0.9602573 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\ndat1.emm <- emmeans(mod1, \"Elevation\")\n# plot(dat1.emm)\n#emmeans::emmip(mod1, growth.Mar.Aug ~ Elevation , CIs = TRUE)\ndat1.emm.df <- as.data.frame(dat1.emm)\nmid <- barplot(data = dat1.emm.df, emmean~Elevation, \n               ylim = c(0,.15), ylab = \"Size-corrected growth (cm per 6-months)\")\narrows(x0=mid, y0=dat1.emm.df$lower.CL, x1=mid, \n       y1=dat1.emm.df$upper.CL, code = 3, angle=90, \n       length=0.1)\n(0.08126638 - 0.05801888) / 0.05801888\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.4006885\n```\n:::\n\n```{.r .cell-code}\n# Time 2\nmod1 <- lm(data = growth.2, growth.Mar.Aug~Elevation*Aug.Length)\nkbl(coef(summary(mod1)))%>%\n  kable_classic_2(full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic-2\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> t value </th>\n   <th style=\"text-align:right;\"> Pr(&gt;|t|) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 0.0927026 </td>\n   <td style=\"text-align:right;\"> 0.0558446 </td>\n   <td style=\"text-align:right;\"> 1.6600097 </td>\n   <td style=\"text-align:right;\"> 0.0992863 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationMid </td>\n   <td style=\"text-align:right;\"> 0.0459385 </td>\n   <td style=\"text-align:right;\"> 0.0940378 </td>\n   <td style=\"text-align:right;\"> 0.4885109 </td>\n   <td style=\"text-align:right;\"> 0.6259986 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationUpper </td>\n   <td style=\"text-align:right;\"> 0.0819102 </td>\n   <td style=\"text-align:right;\"> 0.0633740 </td>\n   <td style=\"text-align:right;\"> 1.2924890 </td>\n   <td style=\"text-align:right;\"> 0.1984458 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Aug.Length </td>\n   <td style=\"text-align:right;\"> -0.0510427 </td>\n   <td style=\"text-align:right;\"> 0.2420486 </td>\n   <td style=\"text-align:right;\"> -0.2108778 </td>\n   <td style=\"text-align:right;\"> 0.8333078 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationMid:Aug.Length </td>\n   <td style=\"text-align:right;\"> -0.2535982 </td>\n   <td style=\"text-align:right;\"> 0.3842576 </td>\n   <td style=\"text-align:right;\"> -0.6599694 </td>\n   <td style=\"text-align:right;\"> 0.5104234 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationUpper:Aug.Length </td>\n   <td style=\"text-align:right;\"> -0.4437342 </td>\n   <td style=\"text-align:right;\"> 0.2742084 </td>\n   <td style=\"text-align:right;\"> -1.6182370 </td>\n   <td style=\"text-align:right;\"> 0.1079986 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\n  # No interactions\nmod1 <- lm(data = growth.2, growth.Mar.Aug~Elevation+Aug.Length)\nkbl(coef(summary(mod1)))%>%\n  kable_classic_2(full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic-2\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n   <th style=\"text-align:right;\"> t value </th>\n   <th style=\"text-align:right;\"> Pr(&gt;|t|) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 0.1689942 </td>\n   <td style=\"text-align:right;\"> 0.0256045 </td>\n   <td style=\"text-align:right;\"> 6.6001825 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationMid </td>\n   <td style=\"text-align:right;\"> -0.0101646 </td>\n   <td style=\"text-align:right;\"> 0.0137095 </td>\n   <td style=\"text-align:right;\"> -0.7414298 </td>\n   <td style=\"text-align:right;\"> 0.4597303 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ElevationUpper </td>\n   <td style=\"text-align:right;\"> -0.0195878 </td>\n   <td style=\"text-align:right;\"> 0.0091685 </td>\n   <td style=\"text-align:right;\"> -2.1364360 </td>\n   <td style=\"text-align:right;\"> 0.0344612 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Aug.Length </td>\n   <td style=\"text-align:right;\"> -0.3851085 </td>\n   <td style=\"text-align:right;\"> 0.1065605 </td>\n   <td style=\"text-align:right;\"> -3.6139895 </td>\n   <td style=\"text-align:right;\"> 0.0004255 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n```{.r .cell-code}\ndat1.emm <- emmeans(mod1, \"Elevation\")\n# plot(dat1.emm)\n#emmeans::emmip(mod1, growth.Mar.Aug ~ Elevation , CIs = TRUE)\ndat1.emm.df <- as.data.frame(dat1.emm)\nmid <- barplot(data = dat1.emm.df, emmean~Elevation, \n               ylim = c(0,.15), ylab = \"\")\narrows(x0=mid, y0=dat1.emm.df$lower.CL, x1=mid, \n       y1=dat1.emm.df$upper.CL, code = 3, angle=90, \n       length=0.1)\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n\n```{.r .cell-code}\n(0.08086259 - 0.05984264) / 0.05984264\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.3512537\n```\n:::\n\n```{.r .cell-code}\nTimepoint_1 <- as.POSIXct( \"2018-02-04\", format=\"%Y-%m-%d\", tz = \"GMT\")\n# Timepoint_2 <- as.POSIXct( \"2018-08-13\", format=\"%Y-%m-%d\", tz = \"GMT\") #Changed 20210405 to avoid 1 day gap in data as loggers were switched out and photos were taken\nTimepoint_1_end <- as.POSIXct( \"2018-08-12\", format=\"%Y-%m-%d\", tz = \"GMT\")\nTimepoint_2_start <- as.POSIXct( \"2018-08-15\", format=\"%Y-%m-%d\", tz = \"GMT\")\nTimepoint_3 <- as.POSIXct( \"2019-03-01\", format=\"%Y-%m-%d\", tz = \"GMT\")\n```\n:::\n\n\n# Relationship between operculum and tissue mass\n\nThis information is not used in this model. It was used for the previous analysis of the larger barnacles.\n\nLarger barnacles did not change in opercular length much, but their tissue mass and condition index varied. We were not able to quantify reproductive ouput, and reproductive timing confounded tissue gain and loss of larger barnacles. Given this issue, we chose to focus on the growth rates of small barnacles.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ============================#\n# Read in tissue mass data ####\n# ============================#\n#setwd(\"C:/Users/eroberts/Box/Sarah and Molly's Box/FHL data/length mass relationship/FHL Collected Barnacles\")\n#setwd(\"~/Box/Sarah and Molly's Box/FHL data/length mass relationship/FHL Collected Barnacles\")\n\nsetwd(\"~/Library/CloudStorage/Box-Box/Sarah and Molly's Box/FHL data/length mass relationship/FHL Collected Barnacles\")\nlen_mass_Feb18 <- read.csv(file = \"FHL 201803_Mar.csv\", stringsAsFactors = FALSE)\nlen_mass_Aug18 <- read.csv(file = \"FHL 201808_Aug.csv\", stringsAsFactors = FALSE)\nlen_mass_Mar19 <- read.csv(file = \"FHL 201903_Mar.csv\", stringsAsFactors = FALSE)\n```\n:::\n\n\n# Read in temperature data\n\nVisually, this looks like: High -- 1.97 m = 6.46 ft Mid -- 1.55 m = 5.08 ft Low -- 1.20 m = 3.93 ft Bars denote plus or minus 0.05 m (= 0.16 ft)\n\nIn email January 8, 2020, Gordon got: High = 1.98m Mid = 1.58m Low = 1.18m\n\nFrom diagrams I know that the whole setup is about 3.5 ft from bottom to top, with 1 ft in between each layer of tiles. More like 2.5 bc not at edge\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#setwd(\"~/Box/Sarah and Molly's Box/FHL data/HOBO data/Tides\")\n#setwd(\"C:/Users/eroberts/Box/Sarah and Molly's Box/FHL data/HOBO data/Tides\")\n# setwd(\"~/Library/CloudStorage/Box-Box/Sarah and Molly's Box/FHL data/HOBO data/Tides\")\n# setwd(\"~/Documents/GitHub/Bglandula_FHL_energetics/data/environmental_data\")\n# READING IN NEW TEMP DATASET ####\ntempdat <- read.csv(here::here(\"data/environmental_data/TempAndWaterLevel_QC.20210401.csv\"), stringsAsFactors = FALSE) #This is saved in r code HoboCombineFHL...v4.R\nstr(tempdat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t54803 obs. of  7 variables:\n $ X          : int  1 2 3 4 5 6 7 8 9 10 ...\n $ datetime   : chr  \"2017-08-07 00:45:00\" \"2017-08-07 01:00:00\" \"2017-08-07 01:15:00\" \"2017-08-07 01:30:00\" ...\n $ Upper      : num  13.7 14.2 14.1 14.1 14 ...\n $ Mid        : num  13.3 14.2 14.1 14.1 14.1 ...\n $ Low        : num  13.2 14.1 14 14 14 ...\n $ Water.Level: num  NA 2.23 2.26 2.29 2.3 ...\n $ Water.Temp : num  16.1 12.8 11.6 11.8 12.8 ...\n```\n:::\n\n```{.r .cell-code}\ntempdat$datetime <- as.POSIXct(tempdat$datetime, tz = \"GMT\")\ndf.new <- tempdat\ntempdat <- tempdat[!is.na(tempdat$Water.Level),]\n\nsubsetcheck1 <- as.POSIXct(\"2018-08-20 00:00:00\")\nsubsetcheck2 <- as.POSIXct(\"2018-08-26 00:00:00\")\ntempdat_subset <- tempdat[tempdat$datetime > subsetcheck1&tempdat$datetime < subsetcheck2,]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntempdat$Upper_air <- tempdat$Upper\ntempdat$Upper_water <- tempdat$Upper\ntempdat$Upper_air[tempdat$Water.Level>=1.97] <- NA\ntempdat$Upper_water[tempdat$Water.Level<1.97] <- NA\n\npar(mfrow = c(1,3))\n# plot(tempdat$Upper_air ~ tempdat$datetime, col = \"red\")\n# points(tempdat$Upper_water ~ tempdat$datetime, col = \"blue\")\nplot(tempdat$Upper_air ~ tempdat$datetime, col = \"red\")\npoints(tempdat$Upper_water ~ tempdat$datetime, col = \"blue\")\n\ntempdat$Mid_air <- tempdat$Mid\ntempdat$Mid_water <- tempdat$Mid\ntempdat$Mid_air[tempdat$Water.Level>=1.55] <- NA\ntempdat$Mid_water[tempdat$Water.Level<1.55] <- NA\nplot(tempdat$Mid_air ~ tempdat$datetime, col = \"red\")\npoints(tempdat$Mid_water ~ tempdat$datetime, col = \"blue\")\n\ntempdat$Low_air <- tempdat$Low\ntempdat$Low_water <- tempdat$Low\ntempdat$Low_air[tempdat$Water.Level>=1.20] <- NA\ntempdat$Low_water[tempdat$Water.Level<1.20] <- NA\nplot(tempdat$Low_air ~ tempdat$datetime, col = \"red\")\npoints(tempdat$Low_water ~ tempdat$datetime, col = \"blue\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwater.temp <- data.frame(\n  datetime = tempdat$datetime,\n  Upper = tempdat$Upper_water,\n  Mid = tempdat$Mid_water,\n  Low = tempdat$Low_water)\n\nair.temp <- data.frame(\n  datetime = tempdat$datetime,\n  Upper = tempdat$Upper_air,\n  Mid = tempdat$Mid_air,\n  Low = tempdat$Low_air)\n\n\n\n#if(timing == 1){ \n  starttime <- Timepoint_1\n  endtime <- Timepoint_1_end\n  air.temp.1 <- air.temp[air.temp$datetime>=starttime & air.temp$datetime<= endtime & !is.na(air.temp$datetime),]\n  water.temp.1 <- water.temp[water.temp$datetime>=starttime & water.temp$datetime<= endtime & !is.na(water.temp$datetime),]\n#}\n\n#if(timing == 2){\n  starttime <- Timepoint_2_start\n  endtime <- Timepoint_3\n  air.temp.2 <- air.temp[air.temp$datetime>=starttime & air.temp$datetime<= endtime & !is.na(air.temp$datetime),]\n  water.temp.2 <- water.temp[water.temp$datetime>=starttime & water.temp$datetime<= endtime & !is.na(water.temp$datetime),]\n#}\n  \n  \n  par(mfrow = c(1,1))\n\nplot(tempdat$Upper, pch = \".\")\npoints(tempdat$Mid, col = \"blue\", pch=\".\")\npoints(tempdat$Low, col = \"orange\", pch = \".\")\ntitle(\"Temps at the 3 tidal elevations over 1 year\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(tempdat_subset$Upper, pch = \".\")\npoints(tempdat_subset$Mid, col = \"blue\", pch=\".\")\npoints(tempdat_subset$Low, col = \"orange\", pch = \".\")\ntitle(\"Temps of the 3 tidal elevations over one week\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(air.temp.1$Upper, pch = \".\")\npoints(air.temp.1$Mid, col = \"blue\", pch=\".\")\npoints(air.temp.1$Low, col = \"orange\", pch = \".\")\ntitle(\"Temps of the 3 tidal elevations over the first 6-month experiment\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-16-3.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(air.temp.2$Upper, pch = \".\")\npoints(air.temp.2$Mid, col = \"blue\", pch=\".\")\npoints(air.temp.2$Low, col = \"orange\", pch = \".\")\ntitle(\"Temps of the 3 tidal elevations over the second 6-month experiment\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-16-4.png){width=672}\n:::\n:::\n\n\n# Food data\n\nData found in:\n\n#setwd(\"\\~/Box/Sarah and Molly's Box/FHL data/SONDE data/Padilla Bay/909184_all_data_2003topresent\")\n\nsetwd(\"C:/Users/eroberts/Box/Sarah and Molly's Box/FHL data/SONDE data/Padilla Bay/909184_all_data_2003topresent\")\n\nsetwd(\"\\~/Library/CloudStorage/Box-Box/Sarah and Molly's Box/FHL data/SONDE data/Padilla Bay/909184_all_data_2003topresent/\")\n\nRead in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPB <- read.csv(here::here(\"data/environmental_data/PDBGSWQ_dataonly.csv\"), stringsAsFactors = FALSE)\n\n#Technically this should be in pdt, but this is being used to calculate weekly averages and lubridate is not working correctly\nPB$datetime <-as.POSIXct(PB$m.d.y.hh.mm, format = \"%m/%d/%y %H:%M\", tz = \"UTC\")\n\n#subset to only include the past 3 years...\ntime_zone <- \"UTC\"\nPB_subset <- PB[PB$datetime > as.POSIXct(\"2017-01-01 00:00:00\", tz = \"UTC\") & PB$datetime< as.POSIXct(\"2020-01-01 00:00:00\", tz = time_zone),]\nPB <- PB_subset\n\nplot(PB$datetime, PB$ug.l, pch = \".\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# plot(PB$datetime, PB$psu, pch = \".\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvars <-\"m.d.y.hh.mm\"\ndat <- PB %>% \n  drop_na(ug.l, any_of(vars))%>%\n  dplyr::group_by(time = week(datetime)) %>% \n  dplyr::summarise(value = mean(ug.l, na.rm = TRUE), .groups = 'keep')\ndat\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 53 × 2\n# Groups:   time [53]\n    time value\n   <dbl> <dbl>\n 1     1 0.632\n 2     2 0.632\n 3     3 0.611\n 4     4 0.577\n 5     5 0.486\n 6     6 0.731\n 7     7 0.869\n 8     8 0.927\n 9     9 1.11 \n10    10 1.31 \n# … with 43 more rows\n```\n:::\n\n```{.r .cell-code}\nplot(dat, type = 'b', ylab = \"fluorescence (ug/L)\", xlab = \"week\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#dat$datetime.2017 <- lubridate::ymd_hms( \"2017-01-01 00:00:01\" ) + lubridate::weeks( dat$time - 1 )\ndat$datetime.2018 <- lubridate::ymd_hms( \"2018-01-01 00:00:01\" ) + lubridate::weeks( dat$time - 1 )\ndat$datetime.2019 <- lubridate::ymd_hms( \"2019-01-01 00:00:01\" ) + lubridate::weeks( dat$time - 1 )\n\nfood <- data.frame(\n  datetime = as.POSIXct(c(dat$datetime.2018, dat$datetime.2019)),\n  food = c(dat$value,dat$value)\n)\n\nplot(food)\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-18-2.png){width=672}\n:::\n\n```{.r .cell-code}\nrequire(zoo)\n# Create zoo library objects\nzf <- zoo(food$food, food$datetime)   # low freq\nzt <- zoo(water.temp.1$Upper, water.temp.1$datetime)  # high freq\nz <- merge(zf,zt,all = TRUE)\nz$zf <- na.approx(z$zf, rule=2)\nfood.interp <- fortify.zoo(z$zf)\nnames(food.interp) <- c(\"datetime\", \"food\")\nwater.temp.1 <- left_join(water.temp.1, food.interp, by = \"datetime\")\n\nzf <- zoo(food$food, food$datetime)   # low freq\nzt <- zoo(water.temp.2$Upper, water.temp.2$datetime)  # high freq\nz <- merge(zf,zt,all = TRUE)\nz$zf <- na.approx(z$zf, rule=2)\nfood.interp <- fortify.zoo(z$zf)\nnames(food.interp) <- c(\"datetime\", \"food\")\nwater.temp.2 <- left_join(water.temp.2, food.interp, by = \"datetime\")\n```\n:::\n\n\nPlots of chlorophyll\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(figs == \"Y\"){\npar(mfrow = c(1,2))\nplot(water.temp.1$food~ water.temp.1$datetime,\n     ylim = c(0,20),\n     ylab = \"Chlorophyll (ug/L)\",\n     xlab = \"Date 2018\",\n     pch = \".\")\nplot(water.temp.2$food~ water.temp.2$datetime,\n     ylim = c(0,20),\n     ylab = \"\",\n     xlab = \"Date 2018-2019\",\n     pch = \".\")\n}\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n```{.r .cell-code}\nIter.len.1 <- as.data.frame(matrix(data = 0, ncol = nrow(growth.1), nrow = length(water.temp.1$datetime)))\nIter.len.1[1,] <- growth.1$Feb.Length\n\nIter.len.2 <- as.data.frame(matrix(data = 0, ncol = nrow(growth.2), nrow = length(water.temp.2$datetime)))\nIter.len.2[1,] <- growth.2$Aug.Length\n```\n:::\n\n\n# Physiology: Thermal performance relationships\n\nRead in feeding, respiration relationships\n\nFeeding \\~ Temp, Aquatic Respiration \\~ Temp, Aerial Respiration \\~ Temp Feeding shrimp per min \\~ Temp C, Upslope to 20 degrees\n\nUse a subset of the data, up to 20 degrees to interpolate feeding rate upslope,\n\nWu and Levings equation with random component, assuming allometric scaling factor\n\n### Feeding rate\n\nFeeding shrimp per min \\~ Temp C, Upslope to 20 degrees\n\nUsing the operculum length allometric factor of 1.88.\n\nData pulled from here:\n\n#setwd(\"\\~/Box/Sarah and Molly's Box/FHL data/aqua feeding and resp\") \\# setwd(\"C:/Users/eroberts/Box/Sarah and Molly's Box/FHL data/aqua feeding and resp\") setwd(\"\\~/Documents/GitHub/Bglandula_FHL_energetics/data/physiology_data\")\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#old version of datafile\n#feed<- read.table(\"aqfeedFHL.csv\", header = T, sep = \",\")\n\nfeed<- read.table(here::here(\"data/physiology_data/aqfeedFHL_log.csv\"), header = T, sep = \",\")\nfeed$Temp <- as.factor(feed$Temp)\nfeed$Temp.n <- as.numeric(as.character(feed$Temp))\nfeed_subset <- feed[feed$Temp.n <= 17,]\nfeed <- feed_subset\nfeed$feedrate.new <- feed$m_filter_300 - feed$a_ave\nfeed$feedrate <- feed$feedrate.new\nfeed <- feed[!is.na(feed$feedrate.new),]\nfeed$ID <- as.factor(feed$ID)\nfeed$bin <- bin(feed$OperculumLength, nbins = 3) #(4.02,4.97] (4.97,5.91] (5.91,6.86]\nfeed$sizeclass <- bin(feed$OperculumLength, nbins = 3, labels = c(\"small\", \"medium\", \"large\"))\n\nFR_T <- nls(feedrate ~ exp(a*Temp.n) * OperculumLength^(1.88) * c,\n            data = feed, start = c(a = .1, c = .0004))\nsummary(FR_T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFormula: feedrate ~ exp(a * Temp.n) * OperculumLength^(1.88) * c\n\nParameters:\n   Estimate Std. Error t value Pr(>|t|)  \na 0.0593597  0.0285303   2.081   0.0520 .\nc 0.0005550  0.0002197   2.527   0.0211 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.0158 on 18 degrees of freedom\n\nNumber of iterations to convergence: 4 \nAchieved convergence tolerance: 4.217e-06\n```\n:::\n\n```{.r .cell-code}\nFR_T_a <- coef(FR_T)[1]\nFR_T_c <- coef(FR_T)[2]\n\nFR_T_fun <- function(temp, size, a = FR_T_a, c = FR_T_c) {\n  out <- exp(a * temp) * size^(1.88) * c\n  return(out)\n}\n\n# Previous version:\n# FR_T <- nlme(feedrate ~ exp(a * Temp.n) * OperculumLength^(1.86) * c,\n#              data = feed,\n#              fixed = a + c~ 1,\n#              random = c ~ 1,\n#              groups = ~ ID,\n#              start = c(a = -.007, c = 100))\n# summary(FR_T)\n# FR_T_a <- FR_T$coefficients$fixed[[1]]\n# FR_T_c <- FR_T$coefficients$fixed[[2]]\n\n# FR_T_fun <- function(temp, size, a = FR_T_a, c = FR_T_c) {\n#   out <- exp(a * temp) * size^(1.86) * c\n#   return(out)\n# }\n\npred.dat.aqua$feedrate <- FR_T_fun(pred.dat.aqua$Temp.n, pred.dat.aqua$OperculumLength)\npred.dat$feedrate <- FR_T_fun(temp = pred.dat$Temp.n, size = pred.dat$OperculumLength)\n\n gg1 <- ggplot(data = pred.dat.aqua, \n       aes(x = as.numeric(Temp.n), \n           y=as.numeric(feedrate), \n           color = OperculumLength, group = as.factor(sizeclass)))+\n  geom_line()+\n  scale_color_viridis(option = \"D\", limits = c(4, 7))+\n  geom_point(data = feed,aes(x=Temp.n,y=feedrate,color=OperculumLength))+\n  xlim(5,34)+\n  ylim(0,.1)+\n  xlab(expression(paste(\"Seawater temp (\",degree,\"C)\")))+\n  ylab(\"Prey per minute (min -1)\")\ngg1\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n## Aquatic respiration (umol oxygen per min) \\~ Temp (deg C)\n\nUpslope to 23 degrees\n\nUse a subset of the data, up to 23 degrees to interpolate respiration rate upslope,\n\nWu and Levings equation with random component, assuming allometric scaling factor\n\nPreviously found:\n\nsetwd(\"\\~/Box/Sarah and Molly's Box/FHL data/aqua feeding and resp\") setwd(\"C:/Users/eroberts/Box/Sarah and Molly's Box/FHL data/aqua feeding and resp\")\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresp<- read.table(here::here(\"data/physiology_data/AQtotalresp_FHL.csv\"), header = T, sep = \",\")\nresp$Temp<- as.factor(resp$Temp)\nresp$Operc\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 5.11 5.11 5.11 5.99 5.99 5.99 5.03 5.03 5.03 5.75 5.75 5.75 5.22 5.22 4.87\n[16] 4.87 4.87 5.86 5.86 5.86 4.63 4.63 4.63 5.77 5.77 5.77 5.46 5.46 5.46 4.50\n[31] 4.50 4.50 5.07 5.07 5.07 5.70 5.70 5.70 4.95 4.95 4.95 5.29 5.29 5.29 4.80\n[46] 4.80 4.80 5.05 5.05 5.05 4.70 4.70 4.70 5.51 5.51 5.51 5.51 5.51 5.51 5.60\n[61] 5.60 5.60\n```\n:::\n\n```{.r .cell-code}\nresp$ID <- as.factor(resp$Barnacle)\nresp$Temp.n <- as.numeric(as.character(resp$Temp))\nresp$sizeclass <- bin(resp$Operc, nbins = 3, labels = c(\"small\", \"medium\", \"large\"))\nresp$bin <- bin(resp$Operc, nbins = 3) #(4.02,4.97] (4.97,5.91] (5.91,6.86]\n\nresp_below_23 <- resp[resp$Temp.n < 23,] #Changed 2020 Aug 12\nresp <- resp_below_23\n\nAQR_T <- nlme(Respiration.Rate ~ c * exp(a * Temp.n) * Operc^1.88,\n              data = resp,\n              fixed = a + c ~ 1,\n              random = c ~ 1,\n              groups = ~ ID,\n              start = c(a = 0.0547657, c = 0.0003792))\nsummary(AQR_T) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: Respiration.Rate ~ c * exp(a * Temp.n) * Operc^1.88 \n  Data: resp \n        AIC       BIC   logLik\n  -379.3246 -372.1878 193.6623\n\nRandom effects:\n Formula: c ~ 1 | ID\n                   c    Residual\nStdDev: 9.908437e-09 0.002966555\n\nFixed effects:  a + c ~ 1 \n       Value  Std.Error DF  t-value p-value\na 0.08030545 0.04076867 22 1.969783  0.0616\nc 0.00003485 0.00002405 22 1.448871  0.1615\n Correlation: \n  a     \nc -0.966\n\nStandardized Within-Group Residuals:\n       Min         Q1        Med         Q3        Max \n-1.4500246 -0.7135749 -0.2393238  0.4736441  2.2773886 \n\nNumber of Observations: 44\nNumber of Groups: 21 \n```\n:::\n\n```{.r .cell-code}\nAQR_T_a <- AQR_T$coefficients$fixed[[1]]\nAQR_T_c <- AQR_T$coefficients$fixed[[2]]\n\nAQR_T_fun <- function(temp, size, c = AQR_T_c, a = AQR_T_a) {\n  out <- c * exp(a * temp) * size^1.88\n  return(out)\n}\n\n\npred.dat.aqua$aq_resp <- AQR_T_fun(temp = pred.dat.aqua$Temp.n, size = pred.dat.aqua$OperculumLength)\npred.dat$aq_resp <- AQR_T_fun(temp = pred.dat$Temp.n, size = pred.dat$OperculumLength)\n\nif(figs == \"Y\"){\n\n    # ggplot(resp,aes(x=Temp.n,y=Respiration.Rate,color=factor(sizeclass)))+\n    #   geom_point()+\n    #   geom_line(data = pred.dat.aqua, \n    #             aes(x = as.numeric(Temp.n), \n    #                 y=as.numeric(aq_resp), \n    #                 color = factor(sizeclass)))+\n    #   xlim(5,18)+\n    #   ylim(0,.01)\n\nresp_aq <- resp\ngg2 <- ggplot(resp_aq,aes(x=Temp.n,y=Respiration.Rate,color=Operc))+\n    geom_point()+\n    scale_color_viridis(option = \"D\", limits = c(4,7))+\n    geom_line(data = pred.dat.aqua, \n              aes(x = as.numeric(Temp.n), \n                  y=as.numeric(aq_resp), \n                  color = OperculumLength, group = as.factor(sizeclass)))+\n    xlim(5,34)+\n    # ylim(0,.01)+\n    xlab(expression(paste(\"Seawater temp (\",degree,\"C)\")))+\n    ylab(\"Aquatic repiration (umol min -1)\")\ngg2  \n\n    }\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n## Aerial exposure respiration (umol oxygen per 15 min) \\~ Temp (deg C)\n\nUpslope to 25 deg, 30 deg, and quadratic\n\nTwo hypotheses: Upslope vs. unimodal hypothesis\n\nData originally here:\n\nsetwd(\"\\~/Box/Sarah and Molly's Box/FHL data/aerial resp\") setwd(\"C:/Users/eroberts/Box/Sarah and Molly's Box/FHL data/aerial resp\")\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresp<- read.csv(here::here(\"data/physiology_data/FHLmean15mins_recovery_forMolly_40deg.csv\"), stringsAsFactors = FALSE, header = T, sep = \",\")\nresp$Temp<- as.factor(resp$Temp)\nresp$Operc <- resp$operculum_length\nresp$Temp.n <- as.numeric(as.character(resp$Temp))\nresp$Respiration.Rate <- resp$air_15min\nresp$Barnacle <- as.factor(resp$Barnacle)\nresp$sizeclass <- bin(resp$Operc, nbins = 3, labels = c(\"small\", \"medium\", \"large\"))\nresp$bin <- bin(resp$Operc, nbins = 3) #(4.02,4.97] (4.97,5.91] (5.91,6.86]\n\nresp_below_30 <- resp[resp$Temp.n <= 30,]\nresp_below_25 <- resp[resp$Temp.n <= 25,]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAER_EXPOSE_T_25 <- nlme(Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32,\n                        data = resp_below_25,\n                        fixed = a + c ~ 1,\n                        random = c ~ 1,\n                        groups = ~ Barnacle,\n                        start = c(a = 0.0547657, c = 0.0003792))\nsummary(AER_EXPOSE_T_25) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32 \n  Data: resp_below_25 \n        AIC      BIC   logLik\n  -79.53297 -73.1989 43.76649\n\nRandom effects:\n Formula: c ~ 1 | Barnacle\n                   c   Residual\nStdDev: 2.586767e-08 0.07174233\n\nFixed effects:  a + c ~ 1 \n       Value   Std.Error DF  t-value p-value\na 0.06727408 0.018785384 14 3.581193  0.0030\nc 0.00072931 0.000296084 14 2.463202  0.0273\n Correlation: \n  a     \nc -0.976\n\nStandardized Within-Group Residuals:\n       Min         Q1        Med         Q3        Max \n-2.0695968 -0.7307817 -0.1549091  0.5659112  2.0172261 \n\nNumber of Observations: 36\nNumber of Groups: 21 \n```\n:::\n\n```{.r .cell-code}\nAER_EXPOSE_T_25_a <- AER_EXPOSE_T_25$coefficients$fixed[[1]]\nAER_EXPOSE_T_25_c <- AER_EXPOSE_T_25$coefficients$fixed[[2]]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAER_EXPOSE_T_30 <- nlme(Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32,\n                        data = resp_below_30,\n                        fixed = a + c ~ 1,\n                        random = c ~ 1,\n                        groups = ~ Barnacle,\n                        start = c(a = 0.0547657, c = 0.0003792))\nsummary(AER_EXPOSE_T_30) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32 \n  Data: resp_below_30 \n        AIC       BIC   logLik\n  -101.7062 -94.47956 54.85311\n\nRandom effects:\n Formula: c ~ 1 | Barnacle\n                  c   Residual\nStdDev: 4.49608e-08 0.07151154\n\nFixed effects:  a + c ~ 1 \n       Value   Std.Error DF  t-value p-value\na 0.04562355 0.011564376 23 3.945181  0.0006\nc 0.00105427 0.000304119 23 3.466623  0.0021\n Correlation: \n  a     \nc -0.967\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-1.96859864 -0.61433908 -0.05521089  0.46918810  1.96195111 \n\nNumber of Observations: 45\nNumber of Groups: 21 \n```\n:::\n\n```{.r .cell-code}\nAER_EXPOSE_T_30_a <- AER_EXPOSE_T_30$coefficients$fixed[[1]]\nAER_EXPOSE_T_30_c <- AER_EXPOSE_T_30$coefficients$fixed[[2]]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAER_EXPOSE_T_all <- nlme(Respiration.Rate ~ c * exp(a1*Temp.n) * exp(a2*Temp.n^2) * Operc^2.32,\n                         data = resp,\n                         fixed = a1 + a2 + c ~ 1,\n                         random = c ~ 1,\n                         groups = ~ Barnacle,\n                         start = c(a1 = 2.201e-01, a2 = -4.623e-03, c = 1.433e-05))\nsummary(AER_EXPOSE_T_all) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: Respiration.Rate ~ c * exp(a1 * Temp.n) * exp(a2 * Temp.n^2) *      Operc^2.32 \n  Data: resp \n        AIC      BIC   logLik\n  -134.7807 -124.065 72.39035\n\nRandom effects:\n Formula: c ~ 1 | Barnacle\n                   c   Residual\nStdDev: 1.911226e-09 0.07668941\n\nFixed effects:  a1 + a2 + c ~ 1 \n         Value  Std.Error DF   t-value p-value\na1  0.19135365 0.05626881 40  3.400706  0.0015\na2 -0.00335510 0.00105077 40 -3.192979  0.0027\nc   0.00025335 0.00018253 40  1.388047  0.1728\n Correlation: \n   a1     a2    \na2 -0.988       \nc  -0.979  0.938\n\nStandardized Within-Group Residuals:\n       Min         Q1        Med         Q3        Max \n-2.0738357 -0.7486660 -0.2012656  0.4367642  3.4985767 \n\nNumber of Observations: 63\nNumber of Groups: 21 \n```\n:::\n\n```{.r .cell-code}\nAER_EXPOSE_T_all_a1 <- AER_EXPOSE_T_all$coefficients$fixed[[1]]\nAER_EXPOSE_T_all_a2 <- AER_EXPOSE_T_all$coefficients$fixed[[2]]\nAER_EXPOSE_T_all_c <- AER_EXPOSE_T_all$coefficients$fixed[[3]]\n```\n:::\n\n\nSet functions\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Aerial exposure respiration rate\nAER_EXPOSE_T_25_fcn <- function(temp, size, c = AER_EXPOSE_T_25_c, a = AER_EXPOSE_T_25_a) {\n  out <- c * exp(a * temp) * size^2.32\n  return(out)\n}\nAER_EXPOSE_T_30_fcn <- function(temp, size, c = AER_EXPOSE_T_30_c, a = AER_EXPOSE_T_30_a) {\n  out <- c * exp(a * temp) * size^2.32\n  return(out)\n}\nAER_EXPOSE_T_all_fcn <- function(temp, size, c = AER_EXPOSE_T_all_c, a1 = AER_EXPOSE_T_all_a1, a2 = AER_EXPOSE_T_all_a2) {\n  out <- c * exp(a1 * temp) * exp(a2 * temp^2) * size^2.32\n  return(out)\n}\n```\n:::\n\n\n#### Compare predicted respiration curves from aerial exposure.\n\nThe dashed line indicates the growth curve when data up to 25C is used.\n\nThe solid line indicates the growth curve when data up to 30C is used.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# predicted values of respiration at a particular size and temp, above and below the graph axis limits won't be included on the graph, and this will produce an unnecessary warning\n\n# Predicted values based on temp and size and function\npred.dat$pred_25 <- AER_EXPOSE_T_25_fcn(pred.dat$Temp.n, pred.dat$Operc)\npred.dat$pred_30 <- AER_EXPOSE_T_30_fcn(pred.dat$Temp.n, pred.dat$Operc)\npred.dat$pred_all <- AER_EXPOSE_T_all_fcn(pred.dat$Temp.n, pred.dat$Operc)\npred.dat.air$pred_25 <- AER_EXPOSE_T_25_fcn(pred.dat.air$Temp.n, pred.dat.air$Operc)\npred.dat.air$pred_30 <- AER_EXPOSE_T_30_fcn(pred.dat.air$Temp.n, pred.dat.air$Operc)\npred.dat.air$pred_all <- AER_EXPOSE_T_all_fcn(pred.dat.air$Temp.n, pred.dat.air$Operc)\npred.dat.air$air_resp_exposure_25 <- AER_EXPOSE_T_25_fcn(temp = pred.dat.air$Temp.n, size = pred.dat.air$OperculumLength)\npred.dat.air$air_resp_exposure_30 <- AER_EXPOSE_T_30_fcn(temp = pred.dat.air$Temp.n, size = pred.dat.air$OperculumLength)\npred.dat.air$air_resp_exposure_all <- AER_EXPOSE_T_all_fcn(temp = pred.dat.air$Temp.n, size = pred.dat.air$OperculumLength)\n\n\nif(figs == \"Y\"){\n  # ggplot(resp,aes(x=Temp.n,y=Respiration.Rate,color=factor(sizeclass)))+\n  #   geom_point()+\n  #   ylab(\"Aerial Respiration (umol per 15 min)\") +\n  #   xlab(\"Temp (deg C)\")+\n  #   geom_line(data = pred.dat, aes(x = as.numeric(Temp.n),\n  #                                  y=as.numeric(pred_30), color = factor(sizeclass)), linetype = \"dashed\")+\n  #   geom_line(data = pred.dat, aes(x = as.numeric(Temp.n),\n  #                                  y=as.numeric(pred_all), color = factor(sizeclass)), linetype = \"dotted\")+\n  #   geom_line(data = pred.dat, aes(x = as.numeric(Temp.n),\n  #                                  y=as.numeric(pred_25), color = factor(sizeclass)), linetype = \"solid\")\n  resp_exp <- resp\n  gg3 <- ggplot(resp_exp,aes(x=Temp.n,y=Respiration.Rate/15,color=Operc))+\n    geom_point()+\n    scale_color_viridis(option = \"D\", limits = c(4,7))+\n    geom_line(data = pred.dat.air, \n              aes(x = as.numeric(Temp.n), \n                  y=as.numeric(pred_25)/15, \n                  color = OperculumLength, group = as.factor(sizeclass)), linetype = \"dashed\")+\n    geom_line(data = pred.dat.air, \n              aes(x = as.numeric(Temp.n), \n                  y=as.numeric(pred_30)/15, \n                  color = OperculumLength, group = as.factor(sizeclass)))+\n    xlim(5,34)+\n    ylim(0,.03)+\n    xlab(expression(paste(\"Low tide temp (\",degree,\"C)\")))+\n    ylab(\"Aerial repiration during exposure \\n (umol per min)\")\n  gg3  \n  }\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n## Aerial recovery respiration \\~ Temp\n\nWe start with umol oxygen total, but then calculate umol oxygen per 15 min exposure \\# Upslope to 30 deg C\n\nTwo hypotheses: Upslope vs. unimodal hypothesis\n\nOriginal file location:\n\nsetwd(\"\\~/Box/Sarah and Molly's Box/FHL data/aerial resp\") setwd(\"C:/Users/eroberts/Box/Sarah and Molly's Box/FHL data/aerial resp\")\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#setwd(\"~/Documents/GitHub/Bglandula_FHL_energetics/data/physiology_data\")\nresp<- read.csv(here::here(\"data/physiology_data/FHLmean15mins_recovery_forMolly_40deg.csv\"), stringsAsFactors = FALSE, header = T, sep = \",\")\nresp$Temp<- as.factor(resp$Temp)\nresp$Operc <- resp$operculum_length\nresp$Temp.n <- as.numeric(as.character(resp$Temp))\nresp$Barnacle <- as.factor(resp$Barnacle)\nresp$Respiration.Rate <- resp$total_aquat\nresp$sizeclass <- bin(resp$Operc, nbins = 3, labels = c(\"small\", \"medium\", \"large\"))\nresp$bin <- bin(resp$Operc, nbins = 3) #(4.02,4.97] (4.97,5.91] (5.91,6.86]\n\n# ramp.time <- (resp$Temp.n-10)/10 * 1\n# time.at.temp <- 5 - ramp.time\n# plot(resp$Temp.n, time.at.temp*60)\n\nresp_below_30 <- resp[resp$Temp.n <= 30,]\nAER_RECOVER_T_30 <- nlme(Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32,\n                         data = resp_below_30,\n                         fixed = a + c ~ 1,\n                         random = c ~ 1,\n                         groups = ~ Barnacle,\n                         start = c(a = 0.0547657, c = 0.0003792))\nsummary(AER_RECOVER_T_30)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32 \n  Data: resp_below_30 \n       AIC      BIC    logLik\n  123.8877 131.1143 -57.94383\n\nRandom effects:\n Formula: c ~ 1 | Barnacle\n                  c Residual\nStdDev: 0.005496651 0.760159\n\nFixed effects:  a + c ~ 1 \n       Value   Std.Error DF  t-value p-value\na 0.02533049 0.007438323 23 3.405403  0.0024\nc 0.02677801 0.004731447 23 5.659582  0.0000\n Correlation: \n  a     \nc -0.922\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-1.57906671 -0.55250687  0.04581654  0.59614921  2.87270684 \n\nNumber of Observations: 45\nNumber of Groups: 21 \n```\n:::\n\n```{.r .cell-code}\nAER_RECOVER_T_30_a <- AER_RECOVER_T_30$coefficients$fixed[[1]]\nAER_RECOVER_T_30_c <- AER_RECOVER_T_30$coefficients$fixed[[2]]\n\nresp_below_25 <- resp[resp$Temp.n <= 25,]\nAER_RECOVER_T_25 <- nlme(Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32,\n                         data = resp_below_25,\n                         fixed = a + c ~ 1,\n                         random = c ~ 1,\n                         groups = ~ Barnacle,\n                         start = c(a = 0.0547657, c = 0.0003792))\nsummary(AER_RECOVER_T_25)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: Respiration.Rate ~ c * exp(a * Temp.n) * Operc^2.32 \n  Data: resp_below_25 \n       AIC      BIC    logLik\n  104.9978 111.3319 -48.49889\n\nRandom effects:\n Formula: c ~ 1 | Barnacle\n                   c  Residual\nStdDev: 3.379089e-07 0.9307663\n\nFixed effects:  a + c ~ 1 \n       Value   Std.Error DF  t-value p-value\na 0.02535853 0.012637535 14 2.006604  0.0645\nc 0.02827648 0.007020458 14 4.027726  0.0012\n Correlation: \n  a     \nc -0.961\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-1.90771877 -0.54742747 -0.03751482  0.85742531  2.64338811 \n\nNumber of Observations: 36\nNumber of Groups: 21 \n```\n:::\n\n```{.r .cell-code}\nAER_RECOVER_T_25_a <- AER_RECOVER_T_25$coefficients$fixed[[1]]\nAER_RECOVER_T_25_c <- AER_RECOVER_T_25$coefficients$fixed[[2]]\n\n\nAER_RECOVER_T_all <- nlme(Respiration.Rate ~ c * exp(a1*Temp.n) * exp(a2*Temp.n^2) * Operc^2.32,\n                         data = resp,\n                         fixed = a1 + a2 + c ~ 1,\n                         random = c ~ 1,\n                         groups = ~ Barnacle,\n                         start = c(a1 = 2.201e-01, a2 = -4.623e-03, c = 1.433e-05))\nsummary(AER_RECOVER_T_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNonlinear mixed-effects model fit by maximum likelihood\n  Model: Respiration.Rate ~ c * exp(a1 * Temp.n) * exp(a2 * Temp.n^2) *      Operc^2.32 \n  Data: resp \n       AIC      BIC    logLik\n  167.9247 178.6404 -78.96236\n\nRandom effects:\n Formula: c ~ 1 | Barnacle\n                   c  Residual\nStdDev: 2.575648e-07 0.8474125\n\nFixed effects:  a1 + a2 + c ~ 1 \n         Value  Std.Error DF   t-value p-value\na1  0.14556719 0.03740761 40  3.891380  0.0004\na2 -0.00320245 0.00077591 40 -4.127322  0.0002\nc   0.01014330 0.00428424 40  2.367581  0.0228\n Correlation: \n   a1     a2    \na2 -0.984       \nc  -0.973  0.923\n\nStandardized Within-Group Residuals:\n        Min          Q1         Med          Q3         Max \n-2.18678256 -0.71760458 -0.03881334  0.67003322  2.61192546 \n\nNumber of Observations: 63\nNumber of Groups: 21 \n```\n:::\n\n```{.r .cell-code}\nAER_RECOVER_T_all_a1 <- AER_RECOVER_T_all$coefficients$fixed[[1]]\nAER_RECOVER_T_all_a2 <- AER_RECOVER_T_all$coefficients$fixed[[2]]\nAER_RECOVER_T_all_c <- AER_RECOVER_T_all$coefficients$fixed[[3]]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAER_RECOVER_T_25_fcn <- function(temp, size, c = AER_RECOVER_T_25_c, a = AER_RECOVER_T_25_a) {\n  out <- c * exp(a * temp) * size^2.32\n  return(out)\n}\nAER_RECOVER_T_30_fcn <- function(temp, size, c = AER_RECOVER_T_30_c, a = AER_RECOVER_T_30_a) {\n  out <- c * exp(a * temp) * size^2.32\n  return(out)\n}\nAER_RECOVER_T_all_fcn <- function(temp, size, c = AER_RECOVER_T_all_c, a1 = AER_RECOVER_T_all_a1, a2 = AER_RECOVER_T_all_a2) {\n  out <- c * exp(a1 * temp) * exp(a2 * temp^2) * size^2.32\n  return(out)\n}\n\n# Here I need to add the weirdness bit to account for time... but after I calc this is OK... \n```\n:::\n\n\nAgain the dashed line represents the fit if data up to 25C is used.\n\nThe solid line represents the fit if data up to 30C is used.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred.dat$pred_25 <- AER_RECOVER_T_25_fcn(pred.dat$Temp.n, pred.dat$Operc)\npred.dat$pred_30 <- AER_RECOVER_T_30_fcn(pred.dat$Temp.n, pred.dat$Operc)\npred.dat$pred_all <- AER_RECOVER_T_all_fcn(pred.dat$Temp.n, pred.dat$Operc)\n\npred.dat.air$pred_25 <- AER_RECOVER_T_25_fcn(pred.dat.air$Temp.n, pred.dat.air$Operc)\npred.dat.air$pred_30 <- AER_RECOVER_T_30_fcn(pred.dat.air$Temp.n, pred.dat.air$Operc)\npred.dat.air$pred_all <- AER_RECOVER_T_all_fcn(pred.dat.air$Temp.n, pred.dat.air$Operc)\n\n\nif(figs == \"Y\"){\n  # ggplot(resp,aes(x=Temp.n,y=Respiration.Rate,color=factor(sizeclass)))+\n  #   geom_point()+\n  #   ylab(\"Aerial recover respiration (total umol)\") +\n  #   xlab(\"Temp (deg C)\")+\n  #   # geom_line(data = pred.dat, aes(x = as.numeric(Temp.n),\n  #   #                                y=as.numeric(pred_all), color = factor(sizeclass)), linetype = \"dashed\")+\n  #   geom_line(data = pred.dat, aes(x = as.numeric(Temp.n),\n  #                                  y=as.numeric(pred_30), color = factor(sizeclass)), linetype = \"dotted\")+\n  #   geom_line(data = pred.dat, aes(x = as.numeric(Temp.n),\n  #                                  y=as.numeric(pred_25), color = factor(sizeclass)), linetype = \"solid\")\n\n  resp_recov <- resp\n  gg4 <- ggplot(resp_recov,aes(x=Temp.n,y=Respiration.Rate,color=Operc))+\n    geom_point()+\n    scale_color_viridis(option = \"D\", limits = c(4,7))+\n    geom_line(data = pred.dat.air, \n              aes(x = as.numeric(Temp.n), \n                  y=as.numeric(pred_25), \n                  color = OperculumLength, group = as.factor(sizeclass)), linetype = \"dashed\")+\n    geom_line(data = pred.dat.air, \n              aes(x = as.numeric(Temp.n), \n                  y=as.numeric(pred_30), \n                  color = OperculumLength, group = as.factor(sizeclass)))+\n    xlim(5,34)+\n    #ylim(0,.01)+\n    xlab(expression(paste(\"Low tide temp (\",degree,\"C)\")))+\n    ylab(\"Aerial recovery total respiration \\n (total umol)\")\n  gg4   \n  \n}\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggarrange(gg1,gg3,gg2,gg4, ncol=2, nrow=2, common.legend = TRUE, legend=\"bottom\")\n```\n\n::: {.cell-output-display}\n![](model_setup_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n## \n",
    "supporting": [
      "model_setup_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}